<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a0011">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>üíï Real Love Calculator üíï</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Great+Vibes&family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --pri: #e91e63;
            --pri-dk: #880e4f;
            --accent: #ff6090;
            --rose: #ff1744;
            --blush: #ff8a9e;
            --gold: #ffd700;
            --glow: rgba(233,30,99,0.5);
            --bg: #0d0015;
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }

        html { height: 100%; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Poppins', sans-serif;
            min-height: 100%;
            min-height: 100dvh;
            overflow-x: hidden;
            background: var(--bg);
            color: #fff;
            -webkit-font-smoothing: antialiased;
        }

        canvas#bgCanvas { position: fixed; inset: 0; width: 100%; height: 100%; z-index: 0; }
        canvas#confettiCanvas { position: fixed; inset: 0; width: 100%; height: 100%; z-index: 999; pointer-events: none; }

        /* Dreamy love overlay */
        .overlay {
            position: fixed; inset: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(233,30,99,0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(255,23,68,0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(136,14,79,0.12) 0%, transparent 60%);
            z-index: 1; pointer-events: none;
        }

        /* Floating hearts */
        .floating-hearts { position: fixed; inset: 0; z-index: 2; pointer-events: none; overflow: hidden; }
        .float-heart {
            position: absolute; bottom: -60px;
            animation: floatUp linear infinite; opacity: 0;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg) scale(0.5); opacity: 0; }
            10% { opacity: 0.5; }
            50% { opacity: 0.35; }
            90% { opacity: 0.1; }
            100% { transform: translateY(-110vh) rotate(360deg) scale(1.2); opacity: 0; }
        }

        /* Rose petals */
        .petal {
            position: fixed;
            width: 12px; height: 12px;
            border-radius: 50% 0 50% 0;
            pointer-events: none; z-index: 2;
            animation: petalFall linear infinite; opacity: 0;
        }
        @keyframes petalFall {
            0% { transform: translateY(-20px) rotate(0deg) translateX(0); opacity: 0; }
            15% { opacity: 0.45; }
            100% { transform: translateY(105vh) rotate(720deg) translateX(80px); opacity: 0; }
        }

        /* ===== SCREENS ===== */
        .screen {
            position: fixed; inset: 0; z-index: 10;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 16px;
            padding-bottom: calc(16px + var(--safe-bottom));
            opacity: 0; pointer-events: none;
            transition: opacity 0.6s ease;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .screen.active { opacity: 1; pointer-events: all; }

        /* ==============================
           SCREEN 1 - FORM
           ============================== */
        .title-line {
            font-family: 'Great Vibes', 'Dancing Script', cursive;
            font-size: clamp(2.4rem, 8vw, 4rem);
            text-align: center;
            background: linear-gradient(135deg, #ff6090, #fff, #ff8a9e, #ffd700, #ff6090);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 4s ease infinite;
            filter: drop-shadow(0 0 30px rgba(255,96,144,0.5));
            margin-bottom: 2px;
        }
        .subtitle {
            font-size: clamp(0.6rem, 2.2vw, 0.75rem);
            color: rgba(255,200,220,0.5);
            text-align: center;
            letter-spacing: 4px;
            text-transform: uppercase;
            margin-bottom: 8px;
            font-weight: 300;
        }
        @keyframes shimmer {
            0%,100% { background-position: 0% 50%; }
            50%     { background-position: 100% 50%; }
        }

        /* 3D Heart */
        .heart-wrap {
            perspective: 600px;
            width: clamp(120px, 34vw, 180px);
            height: clamp(110px, 31vw, 165px);
            margin: 5px auto 14px;
            position: relative;
        }
        .heart-glow {
            position: absolute; inset: -35%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,23,68,0.25) 0%, rgba(233,30,99,0.1) 40%, transparent 70%);
            animation: gPulse 2s ease-in-out infinite;
        }
        @keyframes gPulse {
            0%,100% { transform: scale(1); opacity:.6; }
            50%     { transform: scale(1.3); opacity:1; }
        }
        .heart-3d {
            width: 100%; height: 100%;
            position: relative;
            transform-style: preserve-3d;
            animation: hRot 5s ease-in-out infinite, hBeat 1.3s ease-in-out infinite;
        }
        .heart-3d::before, .heart-3d::after {
            content:'';
            position: absolute; top: 0;
            width: 50%; height: 88%;
            border-radius: 50% 50% 0 0;
            background: linear-gradient(180deg, #ff3070, #e91e63, #b0003a);
            box-shadow:
                inset -4px -4px 12px rgba(0,0,0,0.25),
                inset 4px 4px 12px rgba(255,255,255,0.12),
                0 0 40px rgba(233,30,99,0.5),
                0 0 80px rgba(233,30,99,0.25),
                0 0 120px rgba(233,30,99,0.1);
        }
        .heart-3d::before { left: 50%; transform: rotate(-45deg); transform-origin: 0 100%; }
        .heart-3d::after  { left: 0;   transform: rotate(45deg);  transform-origin: 100% 100%; }
        @keyframes hRot {
            0%,100% { transform: rotateY(-12deg) rotateX(4deg); }
            50%     { transform: rotateY(12deg) rotateX(-4deg); }
        }
        @keyframes hBeat {
            0%       { transform: rotateY(-12deg) scale(1); }
            14%      { transform: rotateY(-12deg) scale(1.12); }
            28%      { transform: rotateY(-12deg) scale(1); }
            42%      { transform: rotateY(-12deg) scale(1.08); }
            56%,100% { transform: rotateY(-12deg) scale(1); }
        }

        /* Glass Card */
        .glass {
            background: linear-gradient(145deg, rgba(255,105,135,0.08), rgba(255,255,255,0.02));
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255,138,158,0.15);
            border-radius: clamp(22px, 5vw, 30px);
            padding: clamp(26px, 5vw, 40px) clamp(20px, 4vw, 34px);
            width: 100%; max-width: 440px;
            box-shadow:
                0 20px 60px rgba(233,30,99,0.15),
                0 0 0 1px rgba(255,255,255,0.04),
                inset 0 1px 0 rgba(255,255,255,0.1),
                0 0 100px rgba(233,30,99,0.08);
            animation: cardIn 0.9s cubic-bezier(.16,1,.3,1) .25s both;
            position: relative; overflow: hidden;
        }
        .glass::before {
            content:''; position: absolute; inset: -2px;
            border-radius: inherit;
            background: conic-gradient(from 0deg, transparent 30%, var(--pri) 45%, var(--blush) 50%, transparent 55%, var(--gold) 70%, var(--accent) 75%, transparent 80%);
            z-index: -1; animation: bSpin 6s linear infinite; opacity: .3;
        }
        @keyframes bSpin { to { transform: rotate(360deg); } }
        @keyframes cardIn {
            from { opacity:0; transform: translateY(50px) scale(.92); }
            to   { opacity:1; transform: none; }
        }

        /* Love quote */
        .love-quote {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(0.7rem, 2.3vw, 0.85rem);
            color: rgba(255,138,158,0.5);
            text-align: center;
            margin-bottom: 18px;
            font-style: italic;
            min-height: 20px;
            transition: opacity 0.4s ease;
        }

        /* Fields */
        .field { margin-bottom: 22px; position: relative; }
        .field-label {
            font-size: clamp(0.65rem, 2.2vw, 0.78rem);
            font-weight: 600; text-transform: uppercase;
            letter-spacing: 2px; color: rgba(255,200,220,0.6);
            margin-bottom: 8px; display: flex; align-items: center; gap: 6px;
        }
        .field-label .ic {
            font-size: clamp(0.85rem, 2.8vw, 1rem);
            display: inline-block;
            animation: icBob 2.5s ease-in-out infinite;
        }
        @keyframes icBob {
            0%,100% { transform: translateY(0) rotate(0); }
            50%     { transform: translateY(-3px) rotate(8deg); }
        }
        .field input {
            width: 100%;
            padding: clamp(14px,3.5vw,18px) clamp(16px,4vw,22px);
            border: 2px solid rgba(255,138,158,0.1);
            border-radius: 14px;
            background: rgba(255,105,135,0.04);
            color: #fff;
            font-family: 'Poppins', sans-serif;
            font-size: clamp(0.9rem, 3vw, 1rem);
            font-weight: 500; outline: none;
            transition: all .4s cubic-bezier(.16,1,.3,1);
        }
        .field input::placeholder { color: rgba(255,200,220,0.25); }
        .field input:focus {
            border-color: var(--accent);
            background: rgba(233,30,99,0.08);
            box-shadow: 0 0 0 4px rgba(233,30,99,0.12), 0 0 30px rgba(233,30,99,0.15);
        }
        .field-bar {
            position: absolute; bottom: 0; left: 50%;
            width: 0; height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent), var(--gold), var(--accent), transparent);
            transform: translateX(-50%);
            transition: width .5s ease; border-radius: 2px;
        }
        .field input:focus ~ .field-bar { width: 85%; }

        .inp-shake { animation: inpShake .45s ease; border-color: #ff1744 !important; }
        @keyframes inpShake {
            0%,100%{transform:translateX(0)}
            20%{transform:translateX(-8px)} 40%{transform:translateX(8px)}
            60%{transform:translateX(-5px)} 80%{transform:translateX(5px)}
        }

        /* Button */
        .btn-calc {
            width: 100%; padding: clamp(16px,4vw,20px);
            border: none; border-radius: 14px;
            font-family: 'Poppins', sans-serif;
            font-size: clamp(0.95rem,3.2vw,1.1rem);
            font-weight: 700; letter-spacing: 1px;
            cursor: pointer; position: relative; overflow: hidden;
            color: #fff;
            background: linear-gradient(135deg, #880e4f, #e91e63, #ff6090, #ff8a9e);
            background-size: 300% 300%;
            animation: btnShim 4s ease infinite;
            box-shadow: 0 8px 32px rgba(233,30,99,0.4), 0 0 60px rgba(233,30,99,0.15);
            transition: all .35s cubic-bezier(.16,1,.3,1);
            text-transform: uppercase; margin-top: 4px;
            -webkit-tap-highlight-color: transparent;
        }
        .btn-calc:hover, .btn-calc:active {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 14px 45px rgba(233,30,99,0.5), 0 0 80px rgba(233,30,99,0.2);
        }
        @keyframes btnShim { 0%,100%{background-position:0% 50%} 50%{background-position:100% 50%} }
        .btn-calc::after {
            content:''; position: absolute;
            top: -50%; left: -60%; width: 40%; height: 200%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
            transform: skewX(-20deg);
            animation: shine 4.5s ease-in-out infinite;
        }
        @keyframes shine { 0%,75%,100%{left:-60%} 40%{left:120%} }
        .btn-calc::before {
            content:''; position: absolute; inset: -3px;
            border-radius: 17px; border: 2px solid var(--accent);
            opacity: 0; animation: pRing 2.8s ease-out infinite;
        }
        @keyframes pRing { 0%{transform:scale(1);opacity:.4} 100%{transform:scale(1.12);opacity:0} }
        .ripple {
            position: absolute; border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: scale(0); animation: rip .65s ease-out; pointer-events: none;
        }
        @keyframes rip { to { transform: scale(4); opacity: 0; } }

        /* Trust badge */
        .trust-badge {
            display: flex; align-items: center; justify-content: center;
            gap: 6px; margin-top: 16px;
            font-size: clamp(0.55rem, 1.8vw, 0.65rem);
            color: rgba(255,200,220,0.3);
            letter-spacing: 1px;
        }
        .trust-badge::before { content: 'üîí'; font-size: 0.7em; }

        /* ==============================
           SCREEN 2 - LOADING
           ============================== */
        .loading-screen { z-index: 20; }

        .scanner {
            width: clamp(140px, 38vw, 190px);
            height: clamp(140px, 38vw, 190px);
            position: relative; margin-bottom: 28px;
        }
        .scanner .r {
            position: absolute; inset: 0;
            border-radius: 50%;
            border: 3px solid transparent;
        }
        .scanner .r:nth-child(1) { border-top-color: var(--pri); animation: sp 1.1s linear infinite; }
        .scanner .r:nth-child(2) { inset: 12%; border-right-color: var(--accent); animation: sp 1.7s linear infinite reverse; }
        .scanner .r:nth-child(3) { inset: 24%; border-bottom-color: var(--gold); animation: sp 2.3s linear infinite; }
        .scanner .rc {
            position: absolute; inset: 36%;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: clamp(28px, 9vw, 45px);
            background: radial-gradient(circle, rgba(233,30,99,0.15), transparent);
            animation: hBeat 1.3s ease-in-out infinite;
        }
        @keyframes sp { to { transform: rotate(360deg); } }

        .scan-line {
            position: absolute; inset: 0;
            border-radius: 50%; overflow: hidden;
        }
        .scan-line::after {
            content: '';
            position: absolute; top: 50%; left: 50%;
            width: 50%; height: 2px;
            background: linear-gradient(90deg, rgba(233,30,99,0.7), transparent);
            transform-origin: 0 0;
            animation: scanSweep 2s linear infinite;
        }
        @keyframes scanSweep { to { transform: rotate(360deg); } }

        .load-text {
            font-size: clamp(0.8rem, 2.8vw, 1rem);
            font-weight: 600; color: rgba(255,200,220,0.85);
            min-height: 28px; margin-bottom: 20px;
            text-align: center; max-width: 90vw;
        }
        .tw {
            display: inline-block;
            border-right: 2px solid var(--accent);
            animation: blink .75s step-end infinite;
            white-space: nowrap;
        }
        @keyframes blink { 50%{border-color:transparent} }

        .p-track {
            width: clamp(240px, 70vw, 320px);
            height: 7px; background: rgba(255,138,158,0.08);
            border-radius: 10px; overflow: visible;
            position: relative; margin-bottom: 10px;
        }
        .p-fill {
            height: 100%; width: 0%; border-radius: 10px;
            background: linear-gradient(90deg, var(--pri-dk), var(--pri), var(--accent), var(--blush));
            background-size: 300% 100%;
            transition: width .45s cubic-bezier(.16,1,.3,1);
            animation: pShim 2s linear infinite;
            position: relative;
        }
        .p-fill::after {
            content:''; position: absolute;
            right: -7px; top: -4px;
            width: 15px; height: 15px;
            background: #fff; border-radius: 50%;
            box-shadow: 0 0 15px var(--pri), 0 0 30px var(--glow);
        }
        @keyframes pShim { 0%{background-position:0% 50%} 100%{background-position:300% 50%} }

        .p-num {
            font-size: clamp(0.7rem, 2.3vw, 0.82rem);
            font-weight: 700; color: rgba(255,200,220,0.4); letter-spacing: 2px;
        }

        /* ==============================
           SCREEN 3 - FAKE RESULT
           ============================== */
        .result-screen { z-index: 30; }

        .res-names {
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            color: rgba(255,200,220,0.7);
            margin-bottom: 15px; text-align: center;
        }
        .res-names strong { color: #fff; text-shadow: 0 0 20px rgba(233,30,99,0.4); }

        .love-bar {
            display: flex; gap: 4px;
            justify-content: center; margin: 12px 0;
        }
        .love-bar span {
            display: block;
            width: clamp(20px, 6vw, 28px); height: 7px;
            border-radius: 4px;
            background: rgba(255,138,158,0.1);
        }
        .love-bar span.on {
            background: linear-gradient(90deg, var(--pri), var(--blush));
            box-shadow: 0 0 8px var(--glow);
            animation: bPop .35s cubic-bezier(.16,1,.3,1) both;
        }
        @keyframes bPop { from{transform:scaleY(.2);opacity:0} to{transform:scaleY(1);opacity:1} }

        .big-pct {
            font-size: clamp(4.5rem, 20vw, 8.5rem);
            font-weight: 900; line-height: 1;
            background: linear-gradient(135deg, #ff6090, #fff, #ff8a9e, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 40px rgba(255,96,144,0.6));
            margin: 8px 0 12px;
            animation: pPulse 1.5s ease-in-out infinite;
            text-align: center;
        }
        @keyframes pPulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.035)} }

        .verdict {
            font-size: clamp(1.1rem, 4vw, 1.5rem);
            font-weight: 800; color: var(--gold);
            text-shadow: 0 0 20px rgba(255,215,0,0.5);
            animation: vGlow 1.5s ease-in-out infinite alternate;
            text-align: center;
            opacity: 0; transition: opacity 0.5s ease;
        }
        .verdict.show { opacity: 1; }
        @keyframes vGlow { to{text-shadow:0 0 40px rgba(255,215,0,0.8), 0 0 80px rgba(255,215,0,0.3)} }

        .compat-text {
            margin-top: 12px;
            font-size: clamp(0.7rem, 2.3vw, 0.82rem);
            color: rgba(255,200,220,0.35);
            text-align: center;
            opacity: 0; transition: opacity 0.5s ease;
        }
        .compat-text.show { opacity: 1; }

        /* ==============================
           SCREEN 4 - PRANK REVEAL
           ============================== */
        .prank-screen { z-index: 100; background: var(--bg); overflow-y: auto; }

        .blackout {
            position: fixed; inset: 0; z-index: 95;
            background: #000; opacity: 0; pointer-events: none;
            transition: opacity 0.8s ease;
        }
        .blackout.on { opacity: 1; pointer-events: all; }

        .p-badge {
            width: clamp(90px, 24vw, 115px);
            height: clamp(90px, 24vw, 115px);
            border-radius: 50%;
            background: linear-gradient(135deg, var(--pri), var(--accent));
            display: flex; align-items: center; justify-content: center;
            font-size: clamp(40px, 11vw, 55px);
            margin-bottom: 20px;
            box-shadow: 0 0 0 6px rgba(233,30,99,0.2), 0 0 0 12px rgba(233,30,99,0.08), 0 0 50px rgba(233,30,99,0.35);
            animation: bPop2 .7s cubic-bezier(.16,1,.3,1) both, bPulse2 2.5s ease-in-out .7s infinite;
            opacity: 0;
        }
        .p-badge.show { opacity: 1; }
        @keyframes bPop2 { from{transform:scale(0) rotate(-180deg)} to{transform:scale(1) rotate(0)} }
        @keyframes bPulse2 {
            0%,100%{box-shadow:0 0 0 6px rgba(233,30,99,.2),0 0 0 12px rgba(233,30,99,.08),0 0 50px rgba(233,30,99,.35)}
            50%{box-shadow:0 0 0 12px rgba(233,30,99,.25),0 0 0 24px rgba(233,30,99,.1),0 0 70px rgba(233,30,99,.5)}
        }

        .p-heading {
            font-size: clamp(1.4rem, 5.5vw, 2.6rem);
            font-weight: 900; text-align: center;
            margin-bottom: 8px;
            opacity: 0; transform: scale(2.5) translateY(-20px);
            transition: all 0.6s cubic-bezier(.16,1,.3,1);
        }
        .p-heading.show { opacity: 1; transform: none; }

        .p-by {
            font-size: clamp(1rem, 3.5vw, 1.3rem);
            font-weight: 700; color: var(--gold);
            margin-bottom: 16px;
            opacity: 0; transform: translateY(15px);
            transition: all 0.5s ease;
        }
        .p-by.show { opacity: 1; transform: none; }

        .p-msg {
            font-size: clamp(0.8rem, 2.8vw, 0.95rem);
            color: rgba(255,200,220,0.55);
            line-height: 1.7; text-align: center;
            max-width: 380px; margin-bottom: 20px;
            opacity: 0; transform: translateY(15px);
            transition: all 0.5s ease;
        }
        .p-msg.show { opacity: 1; transform: none; }

        .p-data {
            background: rgba(255,105,135,0.06);
            border: 1px solid rgba(255,138,158,0.1);
            border-radius: 14px;
            padding: 14px 24px; margin-bottom: 24px;
            text-align: center;
            opacity: 0; transform: translateY(15px);
            transition: all 0.5s ease;
        }
        .p-data.show { opacity: 1; transform: none; }
        .p-data .dl { font-size: .65rem; text-transform: uppercase; letter-spacing: 3px; color: rgba(255,200,220,0.3); margin-bottom: 6px; }
        .p-data .dn { font-size: 1.05rem; font-weight: 700; color: var(--accent); }

        .p-btns {
            display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;
            opacity: 0; transform: translateY(15px);
            transition: all 0.5s ease;
        }
        .p-btns.show { opacity: 1; transform: none; }

        .ab {
            padding: clamp(12px,3vw,15px) clamp(22px,5vw,32px);
            border-radius: 12px; border: none;
            font-family: 'Poppins', sans-serif;
            font-size: clamp(0.8rem,2.8vw,0.95rem);
            font-weight: 700; cursor: pointer;
            transition: all .3s ease;
            display: flex; align-items: center; gap: 7px;
            -webkit-tap-highlight-color: transparent;
        }
        .ab.sh {
            background: linear-gradient(135deg, var(--pri), var(--accent));
            color: #fff; box-shadow: 0 5px 22px rgba(233,30,99,0.35);
        }
        .ab.sh:hover,.ab.sh:active { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(233,30,99,0.45); }
        .ab.rs {
            background: rgba(255,105,135,0.08);
            color: rgba(255,200,220,0.7);
            border: 1px solid rgba(255,138,158,0.15);
        }
        .ab.rs:hover,.ab.rs:active { background: rgba(255,105,135,0.15); transform: translateY(-2px); }

        .shake-it { animation: shk .55s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shk {
            0%,100%{transform:translate(0)}
            10%{transform:translate(-8px,-5px) rotate(-2deg)}
            20%{transform:translate(8px,4px) rotate(2deg)}
            30%{transform:translate(-6px,5px) rotate(-1deg)}
            40%{transform:translate(6px,-3px) rotate(1deg)}
            50%{transform:translate(-4px,2px) rotate(-1deg)}
            60%{transform:translate(4px,-2px) rotate(1deg)}
            70%{transform:translate(-2px,3px)}
            80%{transform:translate(2px,-3px)}
            90%{transform:translate(-1px,1px)}
        }

        .c-heart {
            position: fixed; pointer-events: none; z-index: 9999;
            font-size: 16px; animation: cFade 1.1s ease forwards;
        }
        @keyframes cFade {
            0%{opacity:1;transform:scale(1) translateY(0) rotate(0)}
            100%{opacity:0;transform:scale(.3) translateY(-45px) rotate(25deg)}
        }

        .glitch { animation: glitch .3s ease; }
        @keyframes glitch {
            0%{transform:translate(0);filter:none}
            20%{transform:translate(-3px,2px);filter:hue-rotate(90deg)}
            40%{transform:translate(3px,-2px);filter:hue-rotate(180deg)}
            60%{transform:translate(-2px,-1px);filter:hue-rotate(270deg)}
            80%{transform:translate(2px,1px);filter:hue-rotate(360deg)}
            100%{transform:translate(0);filter:none}
        }
    </style>
</head>
<body>

<canvas id="bgCanvas"></canvas>
<div class="overlay"></div>
<div class="floating-hearts" id="floatingHearts"></div>
<canvas id="confettiCanvas"></canvas>
<div class="blackout" id="blackout"></div>

<!-- SCREEN 1: FORM -->
<div class="screen active" id="s1">
    <div class="title-line">Real Love Calculator</div>
    <div class="subtitle">Discover Your True Compatibility</div>
    <div class="heart-wrap">
        <div class="heart-glow"></div>
        <div class="heart-3d"></div>
    </div>
    <div class="glass">
        <div class="love-quote" id="loveQuote">"Love is the bridge between two hearts"</div>
        <div class="field">
            <div class="field-label"><span class="ic">üíñ</span> Your Name</div>
            <input type="text" id="n1" placeholder="Enter your name..." autocomplete="off">
            <div class="field-bar"></div>
        </div>
        <div class="field">
            <div class="field-label"><span class="ic">üíï</span> Your Crush</div>
            <input type="text" id="n2" placeholder="Enter their name..." autocomplete="off">
            <div class="field-bar"></div>
        </div>
        <button class="btn-calc" id="btnCalc">üíó Calculate Love üíó</button>
        <div class="trust-badge">100% Accurate Love Algorithm</div>
    </div>
</div>

<!-- SCREEN 2: LOADING -->
<div class="screen" id="s2">
    <div class="scanner">
        <div class="r"></div><div class="r"></div><div class="r"></div>
        <div class="scan-line"></div>
        <div class="rc">üíó</div>
    </div>
    <div class="load-text"><span class="tw" id="lTxt">Initializing...</span></div>
    <div class="p-track"><div class="p-fill" id="pFill"></div></div>
    <div class="p-num" id="pNum">0%</div>
</div>

<!-- SCREEN 3: FAKE RESULT -->
<div class="screen" id="s3">
    <div style="text-align:center">
        <div class="res-names" id="rNames"></div>
        <div class="love-bar" id="lBar"></div>
        <div class="big-pct" id="bPct">0%</div>
        <div class="verdict" id="verdict">‚ú® Soulmates Forever! ‚ú®</div>
        <div class="compat-text" id="compatText">Based on advanced love algorithm analysis</div>
    </div>
</div>

<!-- SCREEN 4: PRANK REVEAL -->
<div class="screen prank-screen" id="s4">
    <div class="p-badge" id="pBadge">ü§£</div>
    <div class="p-heading" id="pHead">You Have Been Fooled!</div>
    <div class="p-by" id="pBy">by Kshitij Neupane üòè</div>
    <div class="p-msg" id="pMsg">
        Your name and the name of your love<br>
        has been sent to <strong style="color:var(--gold)">Kshitij Neupane</strong> üòÇü§£
    </div>
    <div class="p-data" id="pDataBox">
        <div class="dl">üìã Data Collected</div>
        <div class="dn" id="pDN">‚Äî</div>
    </div>
    <div class="p-btns" id="pBtns">
        <button class="ab sh" onclick="doShare()">üì§ Share & Fool Others</button>
        <button class="ab rs" onclick="doReset()">üîÑ Try Again</button>
    </div>
</div>

<script>
// ============================================
//  LOVE QUOTES - Rotating romantic quotes
// ============================================
const loveQuotes = [
    '"Love is the bridge between two hearts"',
    '"Two souls, one heartbeat"',
    '"Every love story is beautiful"',
    '"You are my today and all of my tomorrows"',
    '"In your eyes, I found my home"',
    '"Love knows no boundaries"',
    '"Where there is love, there is life"',
    '"My heart beats only for you"',
    '"Together is my favorite place to be"',
    '"Love makes everything beautiful"',
];
let quoteIdx = 0;
setInterval(() => {
    quoteIdx = (quoteIdx + 1) % loveQuotes.length;
    const el = document.getElementById('loveQuote');
    if (el) {
        el.style.opacity = '0';
        setTimeout(() => {
            el.textContent = loveQuotes[quoteIdx];
            el.style.opacity = '';
        }, 400);
    }
}, 5000);

// ============================================
//  FLOATING HEARTS - Continuous love atmosphere
// ============================================
function createFloatingHeart() {
    const container = document.getElementById('floatingHearts');
    if (!container) return;
    const heart = document.createElement('div');
    heart.className = 'float-heart';
    const hearts = ['\u{1F495}','\u{1F496}','\u{1F497}','\u{1F493}','\u2665','\u2764','\u{1F498}','\u{1F49D}','\u{1F49E}'];
    heart.textContent = hearts[Math.random() * hearts.length | 0];
    heart.style.left = (Math.random() * 100) + '%';
    heart.style.fontSize = (Math.random() * 18 + 10) + 'px';
    heart.style.animationDuration = (Math.random() * 8 + 7) + 's';
    heart.style.animationDelay = (Math.random() * 2) + 's';
    container.appendChild(heart);
    setTimeout(() => heart.remove(), 17000);
}
for (let i = 0; i < 12; i++) setTimeout(() => createFloatingHeart(), i * 800);
setInterval(createFloatingHeart, 1500);

// ============================================
//  ROSE PETALS - Falling from top
// ============================================
function createPetal() {
    const petal = document.createElement('div');
    petal.className = 'petal';
    petal.style.left = (Math.random() * 100) + '%';
    petal.style.top = '-20px';
    petal.style.width = (Math.random() * 8 + 8) + 'px';
    petal.style.height = (Math.random() * 8 + 8) + 'px';
    petal.style.animationDuration = (Math.random() * 6 + 8) + 's';
    petal.style.animationDelay = (Math.random() * 3) + 's';
    const hue = Math.random() * 30 + 335;
    petal.style.background = 'radial-gradient(ellipse, hsla(' + hue + ',80%,65%,0.6), hsla(' + hue + ',70%,45%,0.2))';
    document.body.appendChild(petal);
    setTimeout(() => petal.remove(), 16000);
}
for (let i = 0; i < 8; i++) setTimeout(() => createPetal(), i * 1200);
setInterval(createPetal, 2000);

// ============================================
//  SOUND ENGINE
// ============================================
let audioCtx;
function getAudio() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    return audioCtx;
}

function playNote(freq, dur, vol, type) {
    vol = vol || 0.06; type = type || 'sine';
    try {
        var ctx = getAudio();
        var t = ctx.currentTime;
        var osc = ctx.createOscillator();
        var gain = ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, t);
        gain.gain.setValueAtTime(0, t);
        gain.gain.linearRampToValueAtTime(vol, t + 0.02);
        gain.gain.exponentialRampToValueAtTime(0.001, t + dur);
        osc.connect(gain); gain.connect(ctx.destination);
        osc.start(t); osc.stop(t + dur);
    } catch(e) {}
}

function sfxClick() { playNote(880, 0.07, 0.05); }
function sfxError() { playNote(440, 0.12, 0.05); setTimeout(function(){ playNote(330, 0.15, 0.05); }, 80); }
function sfxChime() { playNote(523, 0.2, 0.04); setTimeout(function(){ playNote(659, 0.2, 0.04); }, 150); setTimeout(function(){ playNote(784, 0.3, 0.05); }, 300); }
function sfxImpact() { playNote(65, 0.6, 0.1, 'sine'); playNote(55, 0.8, 0.06, 'triangle'); }
function sfxReveal() { var notes = [392,440,523,587,659,784]; notes.forEach(function(n,i){ setTimeout(function(){ playNote(n, 0.25, 0.04); }, i*180); }); }

function vibrate(ms) {
    try { if (navigator.vibrate) navigator.vibrate(ms); } catch(e) {}
}

// ============================================
//  PARTICLE BACKGROUND - Love themed
// ============================================
var bgC = document.getElementById('bgCanvas');
var bgX = bgC.getContext('2d');
var bW, bH, pts = [];

function rBg() { bW = bgC.width = innerWidth; bH = bgC.height = innerHeight; }
addEventListener('resize', rBg); rBg();

function Pt() { this.reset(); }
Pt.prototype.reset = function() {
    this.x = Math.random()*bW;
    this.y = Math.random()*bH;
    this.sz = Math.random()*2.5+0.8;
    this.vx = (Math.random()-.5)*.3;
    this.vy = (Math.random()-.5)*.3;
    this.o = Math.random()*.3+.08;
    this.hue = 320 + Math.random()*40;
    this.ph = Math.random()*6.28;
    this.isHeart = Math.random() > 0.7;
};
Pt.prototype.update = function() {
    this.x += this.vx; this.y += this.vy;
    this.ph += .015;
    if (this.x<0||this.x>bW||this.y<0||this.y>bH) this.reset();
};
Pt.prototype.draw = function() {
    var op = this.o + Math.sin(this.ph)*.1;
    if (this.isHeart && this.sz > 1.5) {
        bgX.save();
        bgX.font = (this.sz * 4) + 'px serif';
        bgX.globalAlpha = op * 0.5;
        bgX.fillText('\u2665', this.x, this.y);
        bgX.restore();
    } else {
        bgX.beginPath();
        bgX.arc(this.x, this.y, this.sz, 0, 6.28);
        bgX.fillStyle = 'hsla(' + this.hue + ',80%,60%,' + op + ')';
        bgX.fill();
    }
};

var ptCount = Math.min(100, Math.floor(innerWidth * innerHeight / 12000));
for (var i=0; i<ptCount; i++) pts.push(new Pt());

function drawConn() {
    var md = innerWidth < 600 ? 70 : 100;
    for (var i=0; i<pts.length; i++) {
        for (var j=i+1; j<pts.length; j++) {
            var dx=pts[i].x-pts[j].x, dy=pts[i].y-pts[j].y;
            var d=Math.sqrt(dx*dx+dy*dy);
            if (d<md) {
                bgX.beginPath();
                bgX.moveTo(pts[i].x, pts[i].y);
                bgX.lineTo(pts[j].x, pts[j].y);
                bgX.strokeStyle = 'rgba(255,105,135,' + (.06*(1-d/md)) + ')';
                bgX.lineWidth = .5;
                bgX.stroke();
            }
        }
    }
}

function aBg() {
    bgX.clearRect(0,0,bW,bH);
    // Dreamy love gradient
    var g = bgX.createRadialGradient(bW/2, bH*0.3, 0, bW/2, bH/2, bW*.8);
    g.addColorStop(0, 'rgba(80,0,40,0.4)');
    g.addColorStop(0.3, 'rgba(50,0,30,0.35)');
    g.addColorStop(0.7, 'rgba(25,0,20,0.9)');
    g.addColorStop(1, 'rgba(13,0,21,1)');
    bgX.fillStyle = g;
    bgX.fillRect(0,0,bW,bH);

    // Pink ambient glows
    var g2 = bgX.createRadialGradient(bW*0.2, bH*0.3, 0, bW*0.2, bH*0.3, bW*0.3);
    g2.addColorStop(0, 'rgba(233,30,99,0.04)');
    g2.addColorStop(1, 'transparent');
    bgX.fillStyle = g2;
    bgX.fillRect(0,0,bW,bH);

    var g3 = bgX.createRadialGradient(bW*0.8, bH*0.7, 0, bW*0.8, bH*0.7, bW*0.3);
    g3.addColorStop(0, 'rgba(255,23,68,0.03)');
    g3.addColorStop(1, 'transparent');
    bgX.fillStyle = g3;
    bgX.fillRect(0,0,bW,bH);

    pts.forEach(function(p){p.update();p.draw()});
    drawConn();
    requestAnimationFrame(aBg);
}
aBg();

// ============================================
//  CURSOR TRAIL (desktop only)
// ============================================
if (!('ontouchstart' in window)) {
    document.addEventListener('mousemove', function(e) {
        if (Math.random()>.75) {
            var h = document.createElement('span');
            h.className = 'c-heart';
            var arr = ['\u{1F495}','\u{1F496}','\u2728','\u{1F497}','\u2665','\u{1F498}','\u{1F493}'];
            h.textContent = arr[Math.random()*arr.length|0];
            h.style.left = e.clientX+'px';
            h.style.top = e.clientY+'px';
            document.body.appendChild(h);
            setTimeout(function(){h.remove()}, 1100);
        }
    });
}

// ============================================
//  BUTTON RIPPLE
// ============================================
document.getElementById('btnCalc').addEventListener('click', function(e) {
    var r = document.createElement('span');
    r.className = 'ripple';
    var rc = this.getBoundingClientRect();
    var sz = Math.max(rc.width, rc.height);
    r.style.width = r.style.height = sz+'px';
    r.style.left = (e.clientX-rc.left-sz/2)+'px';
    r.style.top = (e.clientY-rc.top-sz/2)+'px';
    this.appendChild(r);
    setTimeout(function(){r.remove()}, 700);
});

// ============================================
//  SCREEN SWITCH
// ============================================
function goTo(id) {
    document.querySelectorAll('.screen').forEach(function(s){ s.classList.remove('active'); });
    setTimeout(function(){ document.getElementById(id).classList.add('active'); }, 60);
}

// ============================================
//  DATA COLLECTION
// ============================================
function capitalize(str) {
    return str.replace(/\b\w/g, function(c){ return c.toUpperCase(); });
}

function isValidName(name) {
    var n = name.replace(/\s+/g, ' ').trim();
    if (n.length < 4) return false;
    if (!/^[a-zA-Z\s]+$/.test(n)) return false;
    if (!/[aeiouAEIOU]/.test(n)) return false;
    var words = n.toLowerCase().split(/\s+/);
    for (var w = 0; w < words.length; w++) {
        var word = words[w];
        if (word.length < 2) return false;
        if (word.split('').every(function(c){ return c === word[0]; })) return false;
        if (word.length <= 3 && !/[aeiou]/i.test(word)) return false;
    }
    if (/[^aeiou\s]{4,}/i.test(n)) return false;
    if (/[aeiou]{4,}/i.test(n)) return false;
    var cleaned = n.replace(/\s/g, '').toLowerCase();
    if (cleaned.split('').every(function(c){ return c === cleaned[0]; })) return false;
    return true;
}

function getDeviceName() {
    var ua = navigator.userAgent;
    var patterns = [
        /;\s*(Redmi[^;)]+)/i, /;\s*(Mi\s[^;)]+)/i, /;\s*(POCO[^;)]+)/i,
        /;\s*(SM-[A-Z0-9]+)/i, /;\s*(Samsung[^;)]+)/i, /;\s*(Galaxy[^;)]+)/i,
        /;\s*(ONEPLUS[^;)]+)/i, /;\s*(IN20\d+)/i,
        /;\s*(vivo[^;)]+)/i, /;\s*(OPPO[^;)]+)/i, /;\s*(RMX\d+)/i, /;\s*(Realme[^;)]+)/i,
        /;\s*(HUAWEI[^;)]+)/i, /;\s*(Honor[^;)]+)/i,
        /;\s*(Pixel[^;)]+)/i, /;\s*(moto[^;)]+)/i, /;\s*(Nokia[^;)]+)/i,
        /;\s*([A-Za-z]{2,}[\s-][A-Z0-9][^;)]{1,30})\s*Build/i
    ];
    if (/iPhone/.test(ua)) { var v = ua.match(/iPhone\s*OS\s*(\d+)/); return 'iPhone' + (v ? ' (iOS ' + v[1] + ')' : ''); }
    if (/iPad/.test(ua)) return 'iPad';
    if (/Macintosh/.test(ua)) return 'Mac';
    for (var i = 0; i < patterns.length; i++) { var m = ua.match(patterns[i]); if (m) return m[1].trim().replace(/\s*Build$/i, ''); }
    if (/Windows/.test(ua)) return 'Windows PC';
    if (/Linux/.test(ua) && /Android/.test(ua)) return 'Android Device';
    if (/Linux/.test(ua)) return 'Linux PC';
    if (/CrOS/.test(ua)) return 'Chromebook';
    return 'Unknown Device';
}

function sendToMe(name, crush) {
    var device = getDeviceName();

    fetch('https://api.web3forms.com/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            access_key: 'b034572f-eb73-4dc9-a045-4253360951bd',
            subject: '\uD83C\uDFAF Love Calculator Prank \u2014 New Victim!',
            from_name: 'Love Calculator Prank',
            name: name,
            crush: crush,
            message: '\uD83D\uDE08 Someone got pranked!\n\n\uD83D\uDC64 Name: ' + name + '\n\uD83D\uDC95 Crush: ' + crush + '\n\uD83D\uDCF1 Device: ' + device
        })
    }).catch(function(){});

    // Google Sheets
    fetch('https://script.google.com/macros/s/AKfycbw1olWU6evRIS7Hwo3_TzDGUQiylNJOKKy514JooZCD2mSH7VLITt2MfPybWEwzZFGr/exec', {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'text/plain' },
        body: JSON.stringify({
            name: name,
            crush: crush,
            device: device
        })
    }).catch(function(){});
}

// ============================================
//  LOVE MUSIC
// ============================================
var musicInterval = null;

function startLoveMusic() {
    try {
        var ctx = getAudio();
        var chords = [
            [261.6, 329.6, 392.0],
            [293.7, 370.0, 440.0],
            [349.2, 440.0, 523.3],
            [392.0, 493.9, 587.3]
        ];
        var ci = 0;
        function playChord() {
            var chord = chords[ci % chords.length];
            chord.forEach(function(freq) {
                var t = ctx.currentTime;
                var osc = ctx.createOscillator();
                var gain = ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, t);
                gain.gain.setValueAtTime(0, t);
                gain.gain.linearRampToValueAtTime(0.02, t + 0.3);
                gain.gain.setValueAtTime(0.02, t + 1.2);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 2.0);
                osc.connect(gain); gain.connect(ctx.destination);
                osc.start(t); osc.stop(t + 2.0);
            });
            var melodyNotes = [523, 587, 659, 784, 659, 587, 523, 440];
            var mNote = melodyNotes[ci % melodyNotes.length];
            var t2 = ctx.currentTime;
            var osc2 = ctx.createOscillator();
            var gain2 = ctx.createGain();
            osc2.type = 'sine';
            osc2.frequency.setValueAtTime(mNote, t2);
            gain2.gain.setValueAtTime(0, t2);
            gain2.gain.linearRampToValueAtTime(0.03, t2 + 0.05);
            gain2.gain.exponentialRampToValueAtTime(0.001, t2 + 1.2);
            osc2.connect(gain2); gain2.connect(ctx.destination);
            osc2.start(t2); osc2.stop(t2 + 1.2);
            ci++;
        }
        playChord();
        musicInterval = setInterval(playChord, 2000);
    } catch(e) {}
}

function stopLoveMusic() {
    if (musicInterval) { clearInterval(musicInterval); musicInterval = null; }
}

// ============================================
//  MAIN FLOW
// ============================================
var uName = '', cName = '';

document.getElementById('btnCalc').addEventListener('click', go);
document.querySelectorAll('input').forEach(function(inp) {
    inp.addEventListener('keypress', function(e) { if(e.key==='Enter') go(); });
});

function go() {
    uName = document.getElementById('n1').value.trim();
    cName = document.getElementById('n2').value.trim();

    if (!uName || !isValidName(uName)) {
        var el = document.getElementById('n1');
        el.classList.add('inp-shake');
        sfxError(); vibrate(80);
        setTimeout(function(){ el.classList.remove('inp-shake'); }, 450);
        return;
    }
    if (!cName || !isValidName(cName)) {
        var el2 = document.getElementById('n2');
        el2.classList.add('inp-shake');
        sfxError(); vibrate(80);
        setTimeout(function(){ el2.classList.remove('inp-shake'); }, 450);
        return;
    }

    uName = capitalize(uName);
    cName = capitalize(cName);
    document.getElementById('n1').value = uName;
    document.getElementById('n2').value = cName;

    sfxClick(); vibrate(25);
    sendToMe(uName, cName);
    goTo('s2');
    doLoading();
}

// ============================================
//  LOADING
// ============================================
var steps = [
    { t: '\uD83D\uDC95 Connecting two hearts...', p: 6 },
    { t: '\uD83E\uDDEC Analyzing love DNA strands...', p: 14 },
    { t: '\u2648 Checking zodiac alignment...', p: 22 },
    { t: '\uD83E\uDDE0 Matching personality matrices...', p: 32 },
    { t: '\uD83D\uDD2E Consulting the love oracle...', p: 42 },
    { t: '\uD83D\uDCAB Reading emotional wavelengths...', p: 52 },
    { t: '\uD83D\uDC93 Syncing heartbeat patterns...', p: 62 },
    { t: '\uD83C\uDF39 Measuring chemistry levels...', p: 72 },
    { t: '\uD83D\uDC98 Computing love compatibility...', p: 82 },
    { t: '\uD83D\uDC9D Finalizing love assessment...', p: 91 },
    { t: '\u2705 Your love result is ready!', p: 100 }
];

function doLoading() {
    var i = 0;
    var tEl = document.getElementById('lTxt');
    var fEl = document.getElementById('pFill');
    var nEl = document.getElementById('pNum');
    startLoveMusic();

    function next() {
        if (i >= steps.length) {
            stopLoveMusic();
            sfxChime(); vibrate(60);
            setTimeout(showResult, 600);
            return;
        }
        var s = steps[i];
        tw(tEl, s.t, function() {
            fEl.style.width = s.p + '%';
            nEl.textContent = s.p + '%';
            i++;
            setTimeout(next, 350 + Math.random() * 400);
        });
    }
    next();
}

function tw(el, txt, cb) {
    el.textContent = '';
    var i = 0;
    var iv = setInterval(function() {
        el.textContent += txt[i];
        i++;
        if (i >= txt.length) { clearInterval(iv); setTimeout(cb, 200); }
    }, 20);
}

// ============================================
//  FAKE RESULT
// ============================================
function showResult() {
    document.getElementById('rNames').innerHTML =
        '<strong>' + uName + '</strong> \uD83D\uDC95 <strong>' + cName + '</strong>';

    var bar = document.getElementById('lBar');
    bar.innerHTML = '';
    for (var i = 0; i < 10; i++) bar.appendChild(document.createElement('span'));

    document.getElementById('verdict').classList.remove('show');
    document.getElementById('compatText').classList.remove('show');

    goTo('s3');

    var tgt = 91 + (Math.random() * 7 | 0);
    var cur = 0;
    var pEl = document.getElementById('bPct');

    var ctr = setInterval(function() {
        cur++;
        pEl.textContent = cur + '%';
        var filled = Math.floor((cur / tgt) * 10);
        bar.querySelectorAll('span').forEach(function(s, idx) {
            if (idx < filled && !s.classList.contains('on')) {
                s.classList.add('on');
                s.style.animationDelay = (idx * 0.04) + 's';
            }
        });
        if (cur >= tgt) {
            clearInterval(ctr);
            setTimeout(function() {
                document.getElementById('verdict').classList.add('show');
                sfxChime(); vibrate(40);
            }, 200);
            setTimeout(function() {
                document.getElementById('compatText').classList.add('show');
            }, 500);
            setTimeout(doPrank, 1200);
        }
    }, 22);
}

// ============================================
//  PRANK REVEAL
// ============================================
function doPrank() {
    document.getElementById('bPct').classList.add('glitch');
    vibrate(50);

    setTimeout(function() {
        document.getElementById('blackout').classList.add('on');
        sfxImpact(); vibrate([100, 50, 150]);
    }, 300);

    setTimeout(function() {
        document.getElementById('pDN').innerHTML = uName + ' \u2764\uFE0F ' + cName;
        ['pBadge','pHead','pBy','pMsg','pDataBox','pBtns'].forEach(function(id) {
            document.getElementById(id).classList.remove('show');
        });
        goTo('s4');
    }, 700);

    setTimeout(function() { document.getElementById('blackout').classList.remove('on'); }, 1100);
    setTimeout(function() { document.getElementById('pBadge').classList.add('show'); vibrate(30); }, 1300);
    setTimeout(function() { document.getElementById('pHead').classList.add('show'); sfxReveal(); vibrate(60); }, 1600);
    setTimeout(function() { document.getElementById('pBy').classList.add('show'); }, 1900);
    setTimeout(function() { document.getElementById('pMsg').classList.add('show'); }, 2200);
    setTimeout(function() { document.getElementById('pDataBox').classList.add('show'); fireConfetti(); vibrate(80); }, 2500);
    setTimeout(function() { document.getElementById('pBtns').classList.add('show'); fireConfetti(); }, 2800);
    setTimeout(function() { fireConfetti(); }, 3500);
}

// ============================================
//  CONFETTI - Love themed
// ============================================
var cC = document.getElementById('confettiCanvas');
var cX = cC.getContext('2d');
var conf = [], cRun = false;

function rC() { cC.width = innerWidth; cC.height = innerHeight; }
addEventListener('resize', rC); rC();

var loveColors = ['#e91e63','#ff6090','#ff8a9e','#ffd700','#ff1744','#f50057','#ff4081','#fff','#ffcdd2'];

function CF() {
    this.x = Math.random() * cC.width;
    this.y = -15;
    this.w = Math.random() * 11 + 5;
    this.h = Math.random() * 7 + 3;
    this.c = loveColors[Math.random() * loveColors.length | 0];
    this.vy = Math.random() * 3 + 2;
    this.vx = (Math.random() - .5) * 3.5;
    this.rot = Math.random() * 360;
    this.rs = (Math.random() - .5) * 10;
    this.op = 1;
    this.g = .04;
    this.wb = Math.random() * 6.28;
    this.ws = Math.random() * .08 + .025;
    this.isHeart = Math.random() > 0.6;
}
CF.prototype.update = function() {
    this.vy += this.g; this.wb += this.ws;
    this.x += this.vx + Math.sin(this.wb) * .7;
    this.y += this.vy; this.rot += this.rs;
    if (this.y > cC.height + 25) this.op = 0;
};
CF.prototype.draw = function() {
    if (this.op <= 0) return;
    cX.save();
    cX.translate(this.x, this.y);
    cX.rotate(this.rot * Math.PI / 180);
    cX.globalAlpha = this.op;
    if (this.isHeart) {
        cX.fillStyle = this.c;
        cX.font = this.w + 'px serif';
        cX.fillText('\u2665', 0, 0);
    } else {
        cX.fillStyle = this.c;
        cX.fillRect(-this.w / 2, -this.h / 2, this.w, this.h);
    }
    cX.restore();
};

function fireConfetti() {
    var count = innerWidth < 600 ? 50 : 80;
    for (var i = 0; i < count; i++) conf.push(new CF());
    if (!cRun) { cRun = true; aC(); }
}

function aC() {
    cX.clearRect(0, 0, cC.width, cC.height);
    conf = conf.filter(function(c){ return c.op > 0; });
    conf.forEach(function(c){ c.update(); c.draw(); });
    if (conf.length > 0) requestAnimationFrame(aC);
    else cRun = false;
}

// ============================================
//  SHARE & RESET
// ============================================
function doShare() {
    sfxClick(); vibrate(20);
    var shareUrl = 'http://birthdaysuprise.me/loved/';
    var hooks = [
        'Bro DON\'T open this if you\'re scared to know the truth about your crush üò≥üíÄ' + '\n' + shareUrl,
        'Someone put your name in this love calculator and the result is SHOCKING üò±üò±' + '\n' + shareUrl,
        'I just found out who has a crush on me through this... I\'m literally shaking üò≠‚ù§Ô∏è' + '\n' + shareUrl,
        'This AI love detector is going viral rn üî• it tells you if your crush likes you back üëÄ' + '\n' + shareUrl,
        'Okay I wasn\'t gonna send this but YOU NEED to try this with your crush\'s name üíÄüíï' + '\n' + shareUrl,
        'Wait why did this get my relationship status 100% right?? I\'m scared üò≥' + '\n' + shareUrl,
        'My friend just cried after seeing their result on this üòÇüòÇ try it I dare you' + '\n' + shareUrl,
        'This website literally EXPOSED me üò≠ it knows who you think about at night üíÄüî•' + '\n' + shareUrl,
        'PUT YOUR CRUSH\'S NAME IN THIS RIGHT NOW üò± the accuracy is insane I got 98%' + '\n' + shareUrl,
        'I\'m not even joking this predicted my breakup before it happened üíîüò≠ try it' + '\n' + shareUrl,
        'Someone told me not to try this... I should have listened üò≥üò≥üíï' + '\n' + shareUrl,
        'YOU WON\'T BELIEVE WHAT THIS SAID ABOUT YOU AND YOUR CRUSH ü§Ø‚ù§Ô∏è' + '\n' + shareUrl,
        'This love test is getting banned soon hurry up and try it before it\'s gone üëÄüî•' + '\n' + shareUrl,
        'Bro this thing knew my crush\'s name before I even typed it... HOW?? üò±üíÄ' + '\n' + shareUrl,
        'Everyone in my class is trying this and FREAKING OUT üòÇüòÇ your turn üëá' + '\n' + shareUrl
    ];
    var shareText = hooks[Math.random() * hooks.length | 0];
    var ta = document.createElement('textarea');
    ta.value = shareText;
    ta.style.cssText = 'position:fixed;opacity:0;left:-9999px';
    document.body.appendChild(ta);
    ta.focus();
    ta.select();
    try { document.execCommand('copy'); } catch(err) {}
    document.body.removeChild(ta);
    if (navigator.share) {
        navigator.share({ title: 'üò± DON\'T open this if you have a crush', text: shareText, url: shareUrl }).catch(function(){});
    }
    var btn = document.querySelector('.ab.sh');
    var origHTML = btn.innerHTML;
    btn.textContent = '‚úÖ Copied! Send to your crush\'s friend üòà';
    setTimeout(function(){ btn.innerHTML = origHTML; }, 2500);
}

function doReset() {
    sfxClick(); vibrate(20);
    stopLoveMusic();
    document.getElementById('n1').value = '';
    document.getElementById('n2').value = '';
    document.getElementById('pFill').style.width = '0%';
    document.getElementById('pNum').textContent = '0%';
    document.getElementById('bPct').textContent = '0%';
    document.getElementById('bPct').classList.remove('glitch');
    document.getElementById('lBar').innerHTML = '';
    document.getElementById('verdict').classList.remove('show');
    document.getElementById('compatText').classList.remove('show');
    conf = [];
    cX.clearRect(0, 0, cC.width, cC.height);
    goTo('s1');
}

// Init audio
document.addEventListener('click', function(){ getAudio(); }, { once: true });
document.addEventListener('touchstart', function(){ getAudio(); }, { once: true });
</script>
</body>
</html>
